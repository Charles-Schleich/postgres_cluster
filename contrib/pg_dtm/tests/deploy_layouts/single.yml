---
- hosts: master-workers
  # gather_facts: no
  roles:

  # - role: postgrespro
  #   deploy_dtm: true

  - role: postgrespro
    deploy_postgres: true
    ppg_usedtm: true
    ppg_dtmhost: "158.250.29.10"
    ppg:
      version: xtm
      src: ./postgrespro
      dst: "/tmp/postgrespro-build"
      log: ./ppg1.log
      datadir: ./postgrespro-data1
      usedtm: true
      node_id: 1
    ppg_configfile:
    # we should so delete/reinit on playbook, after that drop rexeps here
    - line: "shared_buffers = 1024MB" # 1/4 RAM
      regexp: "^shared_buffers "
    - line: "wal_keep_segments = 128"
      regexp: "^wal_keep_segments "
    - line: "fsync = off"
      regexp: "^fsync "
    - line: "autovacuum = off"
      regexp: "^autovacuum "
    - line: "listen_addresses = '*'"
      regexp: "^listen_addresses "
    - line: "port = 5432"
      regexp: "^port "


- hosts: workers
  # gather_facts: no
  roles:

  - role: postgrespro
    deploy_postgres: true
    ppg_usedtm: true
    ppg_dtmhost: "158.250.29.10"
    ppg:
      version: xtm
      src: ./postgrespro
      dst: "/tmp/postgrespro-build"
      log: ./ppg1.log
      datadir: ./postgrespro-data1
      usedtm: true
      node_id: 1
    ppg_configfile:
    # we should so delete/reinit on playbook, after that drop rexeps here
    - line: "shared_buffers = 1024MB" # 1/4 RAM
      regexp: "^shared_buffers "
    - line: "wal_keep_segments = 128"
      regexp: "^wal_keep_segments "
    - line: "fsync = off"
      regexp: "^fsync "
    - line: "autovacuum = off"
      regexp: "^autovacuum "
    - line: "listen_addresses = '*'"
      regexp: "^listen_addresses "
    - line: "port = 5432"
      regexp: "^port "


