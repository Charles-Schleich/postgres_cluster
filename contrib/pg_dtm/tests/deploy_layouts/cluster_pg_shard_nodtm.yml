---
- hosts: dtm
  gather_facts: no
  roles:
  - role: postgrespro
    deploy_dtm: true

- hosts: master-workers
  gather_facts: no
  roles:

  - role: postgrespro
    deploy_postgres: true
    deploy_pg_shard: true
    ppg_usedtm: true
    ppg_dtmhost: "blade8" #!!!
    ppg:
      version: xtm_pgshard
      src: /home/stas/postgrespro
      dst: /home/stas/postgrespro-build
      log: /home/stas/ppg.log
      datadir: /home/stas/postgrespro-data
      usedtm: true
      node_id: 1
    ppg_configfile:
    # we should so delete/reinit on playbook, after that drop rexeps here
    - line: "shared_buffers = 1024MB" # 1/4 RAM
      regexp: "^shared_buffers "
    - line: "wal_keep_segments = 128"
      regexp: "^wal_keep_segments "
    - line: "fsync = off"
      regexp: "^fsync "
    - line: "autovacuum = off"
      regexp: "^autovacuum "
    - line: "listen_addresses = '*'"
      regexp: "^listen_addresses "
    - line: "port = 5432"
      regexp: "^port "


