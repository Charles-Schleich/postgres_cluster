<!-- doc/src/xml/unaccent.xml -->

<sect1 id="unaccent" xreflabel="unaccent">
 <title>unaccent</title>

 <indexterm zone="unaccent"><primary>unaccent</primary></indexterm>

 <para>Модуль <filename>unaccent</filename> представляет словарь текстового поиска, который убирает надстрочные (диакритические) знаки из лексем. Это фильтрующий словарь, что значит, что выводимые им данные всегда передаются следующему словарю (если он есть), в отличие от нормальных словарей. Применяя его, можно выполнить полнотекстовый поиск без учёта ударений (диакритики).</para>

 <para>Текущую реализацию <filename>unaccent</filename> нельзя использовать в качестве нормализующего словаря для словаря <filename>thesaurus</filename>.</para>

 <sect2>
  <title>Конфигурирование</title>

  <para>Словарь <literal>unaccent</literal> принимает следующие параметры:</para>
  <itemizedlist>
   <listitem>
    <para>Параметр <literal>RULES</literal> задаёт базовое имя файла со списком правил преобразования. Этот файл должен находиться в каталоге <filename>$SHAREDIR/tsearch_data/</filename> (где под <literal>$SHAREDIR</literal> понимается каталог с общими данными инсталляции <productname>&productname;</productname>). Имя файла должно заканчиваться расширением <literal>.rules</literal> (которое не нужно указывать в параметре <literal>RULES</literal>).</para>
   </listitem>
  </itemizedlist>
  <para>Файл правил имеет следующий формат:</para>
  <itemizedlist>
   <listitem>
    <para>Каждая строка представляет одно правило перевода, состоящее из символа с диакритикой, за которым следует символ без диакритики. Первый символ переводится во второй. Например, <programlisting>&Agrave;        A
&Aacute;        A
&Acirc;        A
&Atilde;        A
&Auml;        A
&Aring;        A
&AElig;        AE</programlisting> Эти два символа должны разделяться пробельным символом, а любые начальные или конечные пробельные символы в этой строке игнорируются.</para>
   </listitem>

   <listitem>
    <para>В качестве альтернативного варианта, если в строке задан всего один символ, вхождения этого символа будут удаляться; это полезно для языков, в которых диакритика представляется отдельными символами.</para>
   </listitem>

   <listitem>
    <para>На самом деле роль <quote>символа</quote> может играть любая строка, не содержащая пробельные символы, так что словари <filename>unaccent</filename> могут быть полезны и для другого рода замены подстрок, а не только для удаления диакритик.</para>
   </listitem>

   <listitem>
    <para>Как и другие файлы конфигурации текстового поиска в <productname>&productname;</productname>, файл правил должен иметь кодировку UTF-8. При загрузке данные из него будут автоматически преобразованы в кодировку текущей базы данных. Все строки в нём, содержащие непереводимые символы, просто игнорируются, так что файлы правил могут содержать правила, неприменимые в текущей кодировке.</para>
   </listitem>
  </itemizedlist>

  <para>Более полный набор правил, непосредственно пригодный для большинства европейских языков, можно найти в файле <filename>unaccent.rules</filename>, который помещается в <filename>$SHAREDIR/tsearch_data/</filename>, когда устанавливается модуль <filename>unaccent</filename>. Этот файл правил переводит буквы с диакритикой в те же буквы без диакритики, а также разворачивает лигатуры в равнозначные последовательности простых символов (например, &AElig; в AE).</para>
 </sect2>

 <sect2>
  <title>Использование</title>

  <para>При установке расширения <literal>unaccent</literal> в базе создаётся шаблон текстового поиска <literal>unaccent</literal> и словарь <literal>unaccent</literal> на его основе. Для словаря <literal>unaccent</literal> по умолчанию определяется параметр <literal>RULES='unaccent'</literal>, благодаря чему его можно сразу использовать со стандартным файлом <filename>unaccent.rules</filename>. При желании вы можете изменить этот параметр, например, так <programlisting>mydb=# ALTER TEXT SEARCH DICTIONARY unaccent (RULES='my_rules');</programlisting> или создать новые словари на основе этого шаблона.</para>

  <para>Протестировать этот словарь можно так: <programlisting>mydb=# select ts_lexize('unaccent','H&ocirc;tel');
 ts_lexize
-----------
 {Hotel}
(1 row)</programlisting></para>

  <para>Следующий пример показывает, как вставить словарь <filename>unaccent</filename> в конфигурацию текстового поиска: <programlisting>mydb=# CREATE TEXT SEARCH CONFIGURATION fr ( COPY = french );
mydb=# ALTER TEXT SEARCH CONFIGURATION fr
        ALTER MAPPING FOR hword, hword_part, word
        WITH unaccent, french_stem;
mydb=# select to_tsvector('fr','H&ocirc;tels de la Mer');
    to_tsvector
-------------------
 'hotel':1 'mer':4
(1 row)

mydb=# select to_tsvector('fr','H&ocirc;tel de la Mer') @@ to_tsquery('fr','Hotels');
 ?column?
----------
 t
(1 row)

mydb=# select ts_headline('fr','H&ocirc;tel de la Mer',to_tsquery('fr','Hotels'));
      ts_headline
------------------------
 &lt;b&gt;H&ocirc;tel&lt;/b&gt; de la Mer
(1 row)</programlisting></para>
 </sect2>

 <sect2>
 <title>Функции</title>

 <para>Функция <function>unaccent()</function> удаляет надстрочные (диакритические) знаки из заданной строки. По сути она представляет собой обёртку вокруг словарей в стиле <filename>unaccent</filename>, но может вызываться и вне обычного контекста текстового поиска.</para>

 <indexterm><primary>unaccent</primary></indexterm>

<synopsis>unaccent(<optional><replaceable class="parameter">словарь</replaceable>,</optional> <replaceable class="parameter">строка</replaceable>) returns <type>text</type></synopsis>

 <para>Если аргумент <replaceable class="parameter">словарь</replaceable> опущен, подразумевается словарь <literal>unaccent</literal>.</para>

 <para>Пример: <programlisting>SELECT unaccent('unaccent', 'H&ocirc;tel');
SELECT unaccent('H&ocirc;tel');</programlisting></para>
 </sect2>

</sect1>
