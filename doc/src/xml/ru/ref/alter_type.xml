<!--
doc/src/xml/ref/alter_type.xml
&productname; documentation
-->

<refentry id="sql-altertype">
 <indexterm zone="sql-altertype"><primary>ALTER TYPE</primary></indexterm>

 <refmeta>
  <refentrytitle>ALTER TYPE</refentrytitle>
  <manvolnum>7</manvolnum>
  <refmiscinfo>Операторы языка SQL</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>ALTER TYPE</refname>
  <refpurpose>изменить определение типа</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
<synopsis>ALTER TYPE <replaceable class="parameter">имя</replaceable> <replaceable class="parameter">действие</replaceable> [, ... ]
ALTER TYPE <replaceable class="parameter">имя</replaceable> OWNER TO { <replaceable class="parameter">новый_владелец</replaceable> | CURRENT_USER | SESSION_USER }
ALTER TYPE <replaceable class="parameter">имя</replaceable> RENAME ATTRIBUTE <replaceable class="parameter">имя_атрибута</replaceable> TO <replaceable class="parameter">новое_имя_атрибута</replaceable> [ CASCADE | RESTRICT ]
ALTER TYPE <replaceable class="parameter">имя</replaceable> RENAME TO <replaceable class="parameter">новое_имя</replaceable>
ALTER TYPE <replaceable class="parameter">имя</replaceable> SET SCHEMA <replaceable class="parameter">новая_схема</replaceable>
ALTER TYPE <replaceable class="parameter">имя</replaceable> ADD VALUE [ IF NOT EXISTS ] <replaceable class="parameter">новое_значение_перечисления</replaceable> [ { BEFORE | AFTER } <replaceable class="parameter">существующее_значение_перечисления</replaceable> ]

<phrase>Где <replaceable class="parameter">действие</replaceable> может быть следующим:</phrase>

    ADD ATTRIBUTE <replaceable class="parameter">имя_атрибута</replaceable> <replaceable class="parameter">тип_данных</replaceable> [ COLLATE <replaceable class="parameter">правило_сортировки</replaceable> ] [ CASCADE | RESTRICT ]
    DROP ATTRIBUTE [ IF EXISTS ] <replaceable class="parameter">имя_атрибута</replaceable> [ CASCADE | RESTRICT ]
    ALTER ATTRIBUTE <replaceable class="parameter">имя_атрибута</replaceable> [ SET DATA ] TYPE <replaceable class="parameter">тип_данных</replaceable> [ COLLATE <replaceable class="parameter">правило_сортировки</replaceable> ] [ CASCADE | RESTRICT ]</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Описание</title>

  <para><command>ALTER TYPE</command> изменяет определение существующего типа. Эта команда имеет несколько разновидностей: <variablelist>
   <varlistentry>
    <term><literal>ADD ATTRIBUTE</literal></term>
    <listitem>
     <para>Эта форма добавляет в составной тип новый атрибут с тем же синтаксисом, что и <xref linkend="sql-createtype"/>.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>DROP ATTRIBUTE [ IF EXISTS ]</literal></term>
    <listitem>
     <para>Эта форма удаляет атрибут из составного типа. Если указано <literal>IF EXISTS</literal> и атрибут не существует, это не считается ошибкой. В этом случае выдаётся только замечание.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>SET DATA TYPE</literal></term>
    <listitem>
     <para>Эта форма меняет тип атрибута составного типа.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>OWNER</literal></term>
    <listitem>
     <para>Эта форма меняет владельца типа.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>RENAME</literal></term>
    <listitem>
     <para>Эта форма меняет имя типа или имя отдельного атрибута составного типа.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>SET SCHEMA</literal></term>
    <listitem>
     <para>Эта форма переносит тип в другую схему.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>ADD VALUE [ IF NOT EXISTS ] [ BEFORE | AFTER ]</literal></term>
    <listitem>
     <para>Эта форма добавляет новое значение в тип-перечисление. Порядок нового значения в перечислении можно указать, добавив <literal>BEFORE</literal> (перед) или <literal>AFTER</literal> (после) с одним из существующих значений. Если такое указание отсутствует, новый элемент добавляется в конец списка значений.</para>
     <para>С указанием <literal>IF NOT EXISTS</literal>, если тип уже содержит новое значение, ошибки не произойдёт: будет выдано замечание и ничего больше. Без этого указания, если такое значение уже представлено, возникнет ошибка.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>CASCADE</literal></term>
    <listitem>
     <para>Автоматически распространять действие операции на типизированные таблицы, имеющий данный тип, и их потомки.</para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>RESTRICT</literal></term>
    <listitem>
     <para>Отказать в выполнении операции, если изменяемый тип является типом типизированной таблицы. Это поведение по умолчанию.</para>
    </listitem>
   </varlistentry>
  </variablelist></para>

  <para>Операции <literal>ADD ATTRIBUTE</literal>, <literal>DROP ATTRIBUTE</literal> и <literal>ALTER ATTRIBUTE</literal> можно объединить в один список множественных изменений для параллельного выполнения. Например, в одной команде можно добавить сразу несколько атрибутов и/или изменить тип нескольких атрибутов.</para>

  <para>Выполнить <command>ALTER TYPE</command> может только владелец соответствующего типа. Чтобы сменить схему типа, необходимо также иметь право <literal>CREATE</literal> в новой схеме. Чтобы сменить владельца, необходимо быть непосредственным или опосредованным членом новой роли-владельца, а эта роль должна иметь право <literal>CREATE</literal> в схеме типа. (С такими ограничениями при смене владельца не происходит ничего такого, что нельзя было бы сделать, имея право удалить и вновь создать тип. Однако суперпользователь может сменить владельца типа в любом случае.) Чтобы добавить атрибут или изменить тип атрибута, также требуется иметь право <literal>USAGE</literal> для соответствующего типа данных.</para>
 </refsect1>

 <refsect1>
  <title>Параметры</title>

   <para>
    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">имя</replaceable></term>
      <listitem>
       <para>Имя (возможно, дополненное схемой) существующего типа, подлежащего изменению.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">новое_имя</replaceable></term>
      <listitem>
       <para>Новое имя типа.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">новый_владелец</replaceable></term>
      <listitem>
       <para>Имя пользователя, назначаемого новым владельцем типа.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">новая_схема</replaceable></term>
      <listitem>
       <para>Новая схема типа.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">имя_атрибута</replaceable></term>
      <listitem>
       <para>Имя атрибута, подлежащего добавлению, изменению или удалению.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">новое_имя_атрибута</replaceable></term>
      <listitem>
       <para>Новое имя атрибута</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">тип_данных</replaceable></term>
      <listitem>
       <para>Тип данных добавляемого атрибута, либо новый тип данных изменяемого атрибута.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">новое_значение_перечисления</replaceable></term>
      <listitem>
       <para>Новое значение добавляется в список значений перечисления. Как и все элементы перечисления, оно должно заключаться в кавычки.</para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><replaceable class="parameter">существующее_значение_перечисления</replaceable></term>
      <listitem>
       <para>Существующие значение в перечислении, непосредственно перед или после которого по порядку перечисления будет добавлено новое значение. Как и все элементы перечисления, оно должно заключаться в кавычки.</para>
      </listitem>
     </varlistentry>

    </variablelist>
   </para>
  </refsect1>

 <refsect1>
  <title>Замечания</title>

  <para><command>ALTER TYPE ... ADD VALUE</command> (форму, добавляющую в тип-перечисление новое значение) нельзя выполнять внутри блока транзакции.</para>

  <para>Сравнения с добавленными значениями перечисления иногда бывают медленнее сравнений, в которых задействуются только начальные члены типа-перечисления. Обычно это происходит, только если <literal>BEFORE</literal> или <literal>AFTER</literal> устанавливает порядок нового элемента не в конце списка. Однако, иногда это наблюдается даже тогда, когда новое значение добавляется в конец списка (это происходит, если счётчик OID <quote>прокручивается</quote> с момента изначального создания типа-перечисления). Это замедление обычно несущественное, но если это важно, вернуть максимальную производительность можно, удалив и создав заново это перечисление, либо выгрузив копию базы данных и загрузив её вновь.</para>
 </refsect1>

 <refsect1>
  <title>Примеры</title>

  <para>Переименование типа данных: <programlisting>ALTER TYPE electronic_mail RENAME TO email;</programlisting></para>

  <para>Смена владельца типа <literal>email</literal> на <literal>joe</literal>: <programlisting>ALTER TYPE email OWNER TO joe;</programlisting></para>

  <para>Смена схемы типа <literal>email</literal> на <literal>customers</literal>: <programlisting>ALTER TYPE email SET SCHEMA customers;</programlisting></para>

  <para>Добавление в тип нового атрибута: <programlisting>ALTER TYPE compfoo ADD ATTRIBUTE f3 int;</programlisting></para>

  <para>Добавление нового значения в тип-перечисление, в определённое положение по порядку: <programlisting>ALTER TYPE colors ADD VALUE 'orange' AFTER 'red';</programlisting></para>
 </refsect1>

 <refsect1>
  <title>Совместимость</title>

  <para>Формы команды, предназначенные для добавления и удаления атрибутов, являются частью стандарта SQL; другие формы относятся к расширениям &productname;.</para>
 </refsect1>

 <refsect1 id="sql-altertype-see-also">
  <title>См. также</title>

  <simplelist type="inline">
   <member><xref linkend="sql-createtype"/></member>
   <member><xref linkend="sql-droptype"/></member>
  </simplelist>
 </refsect1>
</refentry>
