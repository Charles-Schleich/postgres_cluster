<!-- doc/src/xml/problems.xml -->

<sect1 id="bug-reporting">
 <title>Как правильно сообщить об ошибке</title>

 <para>Если вы найдёте ошибку в <productname>&productname;</productname>, дайте нам знать о ней. Благодаря вашему отчёту об ошибке, <productname>&productname;</productname> станет ещё более надёжным, ведь даже при самом высоком качестве кода нельзя гарантировать, что каждый блок и каждая функция <productname>&productname;</productname> будет работать везде и при любых обстоятельствах.</para>

 <para>Следующие предложения призваны помочь вам в составлении отчёта об ошибке, который можно будет обработать эффективно. Мы не требуем их неукоснительного выполнения, но всё же лучше следовать им для общего блага.</para>

 <para>Мы не можем обещать, что каждая ошибка будет исправлена немедленно. Если ошибка очевидна, критична или касается множества пользователей, велики шансы, что ей кто-то займётся. Бывает, что мы рекомендуем обновить версию и проверить, сохраняется ли ошибка. Мы также можем решить, что ошибку нельзя исправить, пока не будет проделана большая работа, которая уже запланирована. Случается и так, что исправить ошибку слишком сложно, а на повестке дня есть много более важных дел. Если же вы хотите, чтобы вам помогли немедленно, возможно вам стоит заключить договор на коммерческую поддержку.</para>

 <sect2>
  <title>Диагностика ошибок</title>

  <para>Прежде чем сообщать об ошибке, пожалуйста, прочитайте и перечитайте документацию и убедитесь, что вообще возможно сделать то, что вы хотите. Если из документации неясно, можно это сделать или нет, пожалуйста, сообщите и об этом (тогда это ошибка в документации). Если выясняется, что программа делает что-то не так, как написано в документации, это тоже ошибка. Вот лишь некоторые примеры возможных ошибок: <itemizedlist>
    <listitem>
     <para>Программа завершается с аварийным сигналом или сообщением об ошибке операционной системы, указывающей на проблему в программе. (В качестве контрпримера можно привести сообщение <quote>Нет места на диске</quote> &mdash; эту проблему вы должны решить сами.)</para>
    </listitem>

    <listitem>
     <para>Программа выдаёт неправильный результат для любых вводимых данных.</para>
    </listitem>

    <listitem>
     <para>Программа отказывается принимать допустимые (согласно документации) данные.</para>
    </listitem>

    <listitem>
     <para>Программа принимает недопустимые данные без сообщения об ошибке или предупреждения. Но помните: то, что вы считаете недопустимым, мы можем считать приемлемым расширением или совместимым с принятой практикой.</para>
    </listitem>

    <listitem>
     <para>Не удаётся скомпилировать, собрать или установить <productname>&productname;</productname> на поддерживаемой платформе, выполняя соответствующие инструкции.</para>
    </listitem>
   </itemizedlist> Здесь под <quote>программой</quote> подразумевается произвольный исполняемый файл, а не исключительно серверный процесс.</para>

  <para>Медленная работа или высокая загрузка ресурсов &mdash; это не обязательно ошибка. Попробуйте оптимизировать ваши приложения, прочитав документацию или попросив помощи в списках рассылки. Также может не быть ошибкой какое-то несоответствие стандарту <acronym>SQL</acronym>, если только явно не декларируется соответствие в данном аспекте.</para>

  <para>Прежде чем подготовить сообщение, проверьте, не упоминается ли эта ошибка в списке TODO или FAQ. Если вы не можете разобраться в нашем списке TODO, сообщите о своей проблеме. По крайней мере так мы сделаем список TODO более понятным.</para>
 </sect2>

 <sect2>
  <title>Что сообщать</title>

  <para>Главное правило, которое нужно помнить &mdash; сообщайте все факты и только факты. Не стройте догадки, что по вашему мнению работает не так, что <quote>по-видимому происходит</quote>, или в какой части программы ошибка. Если вы не знакомы с тонкостями реализации, вы скорее всего ошибётесь и ничем нам не поможете. И даже если не ошибётесь, расширенные объяснения могут быть прекрасным дополнением, но не заменой фактам. Если мы соберёмся исправить ошибку, мы всё равно сами должны будем посмотреть, в чём она. С другой стороны, сообщить голые факты довольно просто (можно просто скопировать текст с экрана), но часто важные детали опускаются, потому что не считаются таковыми или кажется, что отчёт будет и без того понятен.</para>

  <para>В каждом отчёте об ошибке следует указать: <itemizedlist>
    <listitem>
     <para>Точную последовательность действий для воспроизведения проблемы, начиная <emphasis>с запуска программы</emphasis>. Она должна быть самодостаточной; если вывод зависит от данных в таблицах, то недостаточно сообщить один лишь <command>SELECT</command>, без предшествующих операторов <command>CREATE TABLE</command> и <command>INSERT</command>. У нас не будет времени, чтобы восстанавливать схему базы данных по предоставленной информации, и если предполагается, что мы будем создавать свои тестовые данные, вероятнее всего мы пропустим это сообщение.</para>

     <para>Лучший формат теста для проблем с SQL &mdash; файл, который можно передать программе <application>psql</application> и увидеть проблему. (И убедитесь, что в вашем файле <filename>~/.psqlrc</filename> ничего нет.) Самый простой способ получить такой файл &mdash; выгрузить объявления таблиц и данные, необходимые для создания полигона, с помощью <application>pg_dump</application>, а затем добавить проблемный запрос. Постарайтесь сократить размер вашего тестового примера, хотя это не абсолютно необходимо. Если ошибка воспроизводится, мы найдём её в любом случае.</para>

     <para>Если ваше приложение использует какой-то другой клиентский интерфейс, например <application>PHP</application>, пожалуйста, попытайтесь свести ошибку к проблемным запросам. Мы вряд ли будем устанавливать веб-сервер у себя, чтобы воспроизвести вашу проблему. В любом случае помните, что нам нужны ваши конкретные входные файлы; мы не будем гадать, что подразумевается в сообщении о проблеме с <quote>большими файлами</quote> или <quote>базой среднего размера</quote>, так как это слишком расплывчатые понятия.</para>
    </listitem>

    <listitem>
     <para>Результат, который вы получаете. Пожалуйста, не говорите, что что-то <quote>не работает</quote> или <quote>сбоит</quote>. Если есть сообщение об ошибке, покажите его, даже если вы его не понимаете. Если программа завершается ошибкой операционной системы, сообщите какой. Или если ничего не происходит, отразите это. Даже если в результате вашего теста происходит сбой программы или что-то очевидное, мы можем не наблюдать этого у себя. Проще всего будет скопировать текст с терминала, если это возможно.</para>
     <note>
      <para>Если вы упоминаете сообщение об ошибке, пожалуйста, укажите его в наиболее полной форме. Например, в <application>psql</application>, для этого сначала выполните <literal>\set VERBOSITY verbose</literal>. Если вы цитируете сообщения из журнала событий сервера, присвойте параметру выполнения <xref linkend="guc-log-error-verbosity"/> значение <literal>verbose</literal>, чтобы журнал был наиболее подробным.</para>
     </note>
     <note>
      <para>В случае фатальных ошибок сообщение на стороне клиента может не содержать всю необходимую информацию. Пожалуйста, также изучите журнал сервера баз данных. Если сообщения журнала у вас не сохраняются, это подходящий повод, чтобы начать сохранять их.</para>
     </note>
    </listitem>

    <listitem>
     <para>Очень важно отметить, какой результат вы ожидали получить. Если вы просто напишете <quote>Эта команда выдаёт это.</quote> или <quote>Это не то, что мне нужно.</quote>, мы можем запустить ваш пример, посмотреть на результат и решить, что всё в порядке и никакой ошибки нет. Не заставляйте нас тратить время на расшифровку точного смысла ваших команд. В частности, воздержитесь от утверждений типа <quote>Это не то, что делает Oracle/положено по стандарту SQL</quote>. Выяснять, как должно быть по стандарту <acronym>SQL</acronym>, не очень интересно, а кроме того мы не знаем, как ведут себя все остальные реляционные базы данных. (Если вы наблюдаете аварийное завершение программы, этот пункт, очевидно, неуместен.)</para>
    </listitem>

    <listitem>
     <para>Все параметры командной строки и другие параметры запуска, включая все связанные переменные окружения или файлы конфигурации, которые вы изменяли. Пожалуйста, предоставляйте точные сведения. Если вы используете готовый дистрибутив, в котором сервер БД запускается при загрузке системы, вам следует выяснить, как это происходит.</para>
    </listitem>

    <listitem>
     <para>Всё, что вы делали не так, как написано в инструкциях по установке.</para>
    </listitem>

    <listitem>
     <para>Версию <productname>&productname;</productname>. Чтобы выяснить версию сервера, к которому вы подключены, можно выполнить команду <literal>SELECT pgpro_version();</literal>. Большинство исполняемых программ также поддерживают параметр <option>--version</option>; как минимум должно работать <literal>postgres --version</literal> и <literal>psql --version</literal>. Если такая функция или параметры не поддерживаются, вероятно вашу версию давно пора обновить. Если вы используете дистрибутивный пакет, например RPM, сообщите это, включая полную версию этого пакета. Если же вы работаете со снимком Git, укажите это и хеш последней правки.</para>

     <para>Если ваша версия старее, чем &version;, мы почти наверняка посоветуем вам обновиться. В каждом новом выпуске очень много улучшений и исправлений ошибок, так что ошибка, которую вы встретили в старой версии <productname>&productname;</productname>, скорее всего уже исправлена. Мы можем обеспечить только ограниченную поддержку для тех, кто использует старые версии <productname>&productname;</productname>; если вам этого недостаточно, подумайте о заключении договора коммерческой поддержки.</para>
     <para>
     </para>
    </listitem>

    <listitem>
     <para>Сведения о платформе, включая название и версию ядра, библиотеки C, характеристики процессора, памяти и т. д. Часто бывает достаточно сообщить название и версию ОС, но не рассчитывайте, что все знают, что именно подразумевается под <quote>Debian</quote>, или что все используют i386. Если у вас возникают сложности со сборкой кода и установкой, также необходима информация о сборочной среде вашего компьютера (компилятор, <application>make</application> и т. д.).</para>
    </listitem>
   </itemizedlist> Не бойтесь, если ваш отчёт об ошибке не будет краток. У таланта есть ещё и брат. Лучше сообщить обо всём сразу, чем мы будем потом выуживать факты из вас. С другой стороны, если файлы, которые вы хотите показать, велики, правильнее будет сначала спросить, хочет ли кто-то взглянуть на них. В <ulink url="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html">этой статье</ulink> вы найдёте другие советы по составлению отчётов об ошибках.</para>

  <para>Не тратьте всё своё время, чтобы выяснить, при каких входных данных исчезает проблема. Это вряд ли поможет решить её. Если выяснится, что быстро исправить ошибку нельзя, тогда у вас будет время найти обходной путь и сообщить о нём. И опять же, не тратьте своё время на выяснение, почему возникает эта ошибка. Мы найдём её причину достаточно быстро.</para>

  <para>Сообщая об ошибке, старайтесь не допускать путаницы в терминах. Программный пакет в целом называется <quote>&productname;</quote>, иногда <quote>Postgres</quote> для краткости. Если вы говорите именно о серверном процессе, упомяните это; не следует говорить <quote>сбой в &productname;</quote>. Сбой одного серверного процесса кардинально отличается от сбоя родительского процесса <quote>postgres</quote>, поэтому, пожалуйста, не называйте <quote>сбоем сервера</quote> отключение одного из подчинённых серверных процессов и наоборот. Кроме того, клиентские программы, такие как интерактивный <quote><application>psql</application></quote> существуют совершенно отдельно от серверной части. По возможности постарайтесь точно указать, где наблюдается проблема, на стороне клиента или сервера.</para>
 </sect2>

 <sect2>
  <title>Куда сообщать</title>

  <para>В общем случае посылать сообщения об ошибках следует по адресу <email>bugs@postgrespro.ru</email>. Мы просим вас написать информативную тему письма, возможно включив в неё часть сообщения об ошибке.</para>

  <para>Не отправляйте отчёты об ошибках, специфичных для <productname>Postgres Pro</productname>, на адрес поддержки <productname>PostgreSQL</productname>, так как <productname>Postgres Pro</productname> не поддерживается сообществом <productname>PostgreSQL</productname>. Однако вы можете сообщать по адресу <email>bugs@postgresql.org</email> обо всех ошибках, связанных с <productname>PostgreSQL</productname>.</para>

  <para>Даже если ваша ошибка не связана с особенностями <productname>Postgres Pro</productname>, не посылайте сообщения в списки рассылки для пользователей, например в <email>pgsql-sql@postgresql.org</email> или <email>pgsql-general@postgresql.org</email>. Эти рассылки предназначены для ответов на вопросы пользователей, и их подписчики обычно не хотят получать сообщения об ошибках, более того, они вряд ли исправят их.</para>

  <para>Также, пожалуйста, <emphasis>не</emphasis> отправляйте отчёты об ошибках в список <email>pgsql-hackers@postgresql.org</email>. Этот список предназначен для обсуждения разработки <productname>PostgreSQL</productname>, и будет лучше, если сообщения об ошибках будут существовать отдельно. Хотя мы можем перенести обсуждение вашей ошибки в <literal>pgsql-hackers</literal>, если связанная с <productname>PostgreSQL</productname> требует дополнительного рассмотрения.</para>
 </sect2>
</sect1>
