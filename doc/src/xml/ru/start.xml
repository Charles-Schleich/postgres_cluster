<!-- doc/src/xml/start.xml -->

 <chapter id="tutorial-start">
  <title>Начало</title>

  <sect1 id="tutorial-install">
   <title>Установка</title>

   <para>Прежде чем вы сможете использовать <productname>&productname;</productname>, вы конечно должны его установить. Однако возможно, что <productname>&productname;</productname> уже установлен у вас, либо потому что он включён в вашу операционную систему, либо его установил системный администратор. Если это так, обратитесь к документации по операционной системе или к вашему администратору и узнайте, как получить доступ к <productname>&productname;</productname>.</para>

   <para>Если вы устанавливаете <productname>&productname;</productname> самостоятельно, воспользуйтесь инструкциями по установке (<xref linkend="installation-bin"/>), а закончив установку, вернитесь к этому введению. Обязательно прочитайте и выполните указания по установке соответствующих переменных окружения.</para>

   <para>Если ваш администратор выполнил установку не с параметрами по умолчанию, вам может потребоваться проделать дополнительную работу. Например, если сервер баз данных установлен на удалённом компьютере, вам нужно будет указать в переменной окружения <envar>PGHOST</envar> имя этого компьютера. Вероятно, также придётся установить переменную окружения <envar>PGPORT</envar>. То есть, если вы пытаетесь запустить клиентское приложение и оно сообщает, что не может подключиться к базе данных, вы должны обратиться к вашему администратору. Если это вы сами, вам следует обратиться к документации и убедиться в правильности настройки окружения. Если вы не поняли, о чём здесь идёт речь, перейдите к следующему разделу.</para>
  </sect1>


  <sect1 id="tutorial-arch">
   <title>Основы архитектуры</title>

   <para>Прежде чем продолжить, вы должны разобраться в основах архитектуры системы <productname>&productname;</productname>. Составив картину взаимодействия частей <productname>&productname;</productname>, вы сможете лучше понять материал этой главы.</para>

   <para>Говоря техническим языком, <productname>&productname;</productname> реализован в архитектуре клиент-сервер. Рабочий сеанс <productname>&productname;</productname> включает следующие взаимодействующие процессы (программы): <itemizedlist>
     <listitem>
      <para>Главный серверный процесс, управляющий файлами баз данных, принимающий подключения клиентских приложений и выполняющий различные запросы клиентов к базам данных. Эта программа сервера БД называется <filename>postgres</filename>. <indexterm><primary>postgres</primary></indexterm></para>
     </listitem>

     <listitem>
      <para>Клиентское приложение пользователя, желающее выполнять операции в базе данных. Клиентские приложения могут быть очень разнообразными: это может быть текстовая утилита, графическое приложение, веб-сервер, использующий базу данных для отображения веб-страниц, или специализированный инструмент для обслуживания БД. Некоторые клиентские приложения поставляются в составе дистрибутива <productname>&productname;</productname>, однако большинство создают сторонние разработчики.</para>
     </listitem>

    </itemizedlist></para>

   <para>Как и в других типичных клиент-серверных приложениях, клиент и сервер могут располагаться на разных компьютерах. В этом случае они взаимодействуют по сети TCP/IP. Важно не забывать это и понимать, что файлы, доступные на клиентском компьютере, могут быть недоступны (или доступны только под другим именем) на компьютере-сервере.</para>

   <para>Сервер <productname>&productname;</productname> может обслуживать одновременно несколько подключений клиентов. Для этого он запускает (<quote>порождает</quote>) отдельный процесс для каждого подключения. Можно сказать, что клиент и серверный процесс общаются, не затрагивая главный процесс <filename>postgres</filename>. Таким образом, главный серверный процесс всегда работает и ожидает подключения клиентов, принимая которые, он организует взаимодействие клиента и отдельного серверного процесса. (Конечно всё это происходит незаметно для пользователя, а эта схема рассматривается здесь только для понимания.)</para>
  </sect1>


  <sect1 id="tutorial-createdb">
   <title>Создание базы данных</title>

   <indexterm zone="tutorial-createdb"><primary>база данных</primary> <secondary>создание</secondary></indexterm>

   <indexterm zone="tutorial-createdb"><primary>createdb</primary></indexterm>

   <para>Первое, как можно проверить, есть ли у вас доступ к серверу баз данных, &mdash; это попытаться создать базу данных. Работающий сервер <productname>&productname;</productname> может управлять множеством баз данных, что позволяет создавать отдельные базы данных для разных проектов и пользователей.</para>

   <para>Возможно, ваш администратор уже создал базу данных для вас. В этом случае вы можете пропустить этот этап и перейти к следующему разделу.</para>

   <para>Для создания базы данных, в этом примере названной <literal>mydb</literal>, выполните следующую команду: <screen>
<prompt>$</prompt> <userinput>createdb mydb</userinput>
</screen> Если вы не увидите никаких сообщений, значит операция была выполнена успешно и продолжение этого раздела можно пропустить.</para>

   <para>Если вы видите сообщение типа: <screen>
createdb: command not found
</screen>значит <productname>&productname;</productname> не был установлен правильно. Либо он не установлен вообще, либо в путь поиска команд оболочки не включён его каталог. Попробуйте вызвать ту же команду, указав абсолютный путь: <screen>
<prompt>$</prompt> <userinput>/usr/local/pgsql/bin/createdb mydb</userinput>
</screen> У вас этот путь может быть другим. Свяжитесь с вашим администратором или проверьте, как были выполнены инструкции по установке, чтобы исправить ситуацию.</para>

   <para>Ещё один возможный ответ: <screen>
createdb: не удалось подключиться к базе postgres:
  не удалось подключиться к серверу: No such file or directory
        Он действительно работает локально и принимает
        соединения через доменный сокет "/tmp/.s.PGSQL.5432"?
</screen> Это означает, что сервер не работает или <command>createdb</command> не может к нему подключиться. И в этом случае пересмотрите инструкции по установке или обратитесь к администратору.</para>

   <para>Также вы можете получить сообщение: <screen>
createdb: не удалось подключиться к базе postgres:
  ВАЖНО:  роль "joe" не существует
</screen>где фигурирует ваше имя пользователя. Это говорит о том, что администратор не создал учётную запись <productname>&productname;</productname> для вас. (Учётные записи <productname>&productname;</productname> отличаются от учётных записей пользователей операционной системы.) Если вы сами являетесь администратором, прочитайте <xref remap="4" linkend="user-manag"/>, где написано, как создавать учётные записи. Для создания нового пользователя вы должны стать пользователем операционной системы, под именем которого был установлен <productname>&productname;</productname> (обычно это <literal>postgres</literal>). Также возможно, что вам назначено имя пользователя <productname>&productname;</productname>, не совпадающее с вашим именем в ОС; в этом случае вам нужно явно указать ваше имя пользователя <productname>&productname;</productname>, используя ключ <option>-U</option> или установив переменную окружения <envar>PGUSER</envar>.</para>

   <para>Если у вас есть учётная запись пользователя, но нет прав на создание базы данных, вы увидите сообщение: <screen>
createdb: создать базу данных не удалось:
  ОШИБКА:  нет прав на создание базы данных
</screen> Создавать базы данных разрешено не всем пользователям. Если <productname>&productname;</productname> отказывается создавать базы данных для вас, значит вам необходимо соответствующее разрешение. В этом случае обратитесь к вашему администратору. Если вы устанавливали <productname>&productname;</productname> сами, то для целей этого введения вы должны войти в систему с именем пользователя, запускающего сервер БД. <footnote>
     <para>Объяснить это поведение можно так: Учётные записи пользователей <productname>&productname;</productname> отличаются от учётных записей операционной системы. При подключении к базе данных вы можете указать, с каким именем пользователя <productname>&productname;</productname> нужно подключаться. По умолчанию же используется имя, с которым вы зарегистрированы в операционной системе. При этом получается, что в <productname>&productname;</productname> всегда есть учётная запись с именем, совпадающим с именем системного пользователя, запускающего сервер, и к тому же этот пользователь всегда имеет права на создание баз данных. И чтобы подключиться с именем этого пользователя <productname>&productname;</productname>, необязательно входить с этим именем в систему, достаточно везде передавать его с параметром <option>-U</option>.</para>
    </footnote></para>

   <para>Вы также можете создавать базы данных с другими именами. <productname>&productname;</productname> позволяет создавать сколько угодно баз данных. Имена баз данных должны начинаться с буквы и быть не длиннее 63 символов. В качестве имени базы данных удобно использовать ваше текущее имя пользователя. Многие утилиты предполагают такое имя по умолчанию, так что вы сможете упростить ввод команд. Чтобы создать базу данных с таким именем, просто введите: <screen>
<prompt>$</prompt> <userinput>createdb</userinput>
</screen></para>

   <para>Если вы больше не хотите использовать вашу базу данных, вы можете удалить её. Например, если вы владелец (создатель) базы данных <literal>mydb</literal>, вы можете уничтожить её, выполнив следующую команду: <screen>
<prompt>$</prompt> <userinput>dropdb mydb</userinput>
</screen> (Эта команда не считает именем БД по умолчанию имя текущего пользователя, вы должны явно указать его.) В результате будут физически удалены все файлы, связанные с базой данных, и так как отменить это действие нельзя, не выполняйте его, не подумав о последствиях.</para>

   <para>Узнать о командах <command>createdb</command> и <command>dropdb</command> больше можно в справке <xref linkend="app-createdb"/> и <xref linkend="app-dropdb"/>.</para>
  </sect1>


  <sect1 id="tutorial-accessdb">
   <title>Подключение к базе данных</title>

   <indexterm zone="tutorial-accessdb"><primary>psql</primary></indexterm>

   <para>Создав базу данных, вы можете обратиться к ней: <itemizedlist spacing="compact" mark="bullet">
     <listitem>
      <para>Запустив терминальную программу <productname>&productname;</productname> под названием <application><firstterm>psql</firstterm></application>, в которой можно интерактивно вводить, редактировать и выполнять команды <acronym>SQL</acronym>.</para>
     </listitem>

     <listitem>
      <para>Используя существующие графические инструменты, например, <application>pgAdmin</application> или офисный пакет с поддержкой <acronym>ODBC</acronym> или <acronym>JDBC</acronym>, позволяющий создавать и управлять базой данных. Эти возможности здесь не рассматриваются.</para>
     </listitem>

     <listitem>
      <para>Написав собственное приложение, используя один из множества доступных языковых интерфейсов. Подробнее это рассматривается в <xref remap="6" linkend="client-interfaces"/>.</para>
     </listitem>
    </itemizedlist> Чтобы работать с примерами этого введения, начните с <command>psql</command>. Подключиться с его помощью к базе данных <literal>mydb</literal> можно, введя команду: <screen>
<prompt>$</prompt> <userinput>psql mydb</userinput>
</screen> Если имя базы данных не указать, она будет выбрана по имени пользователя. Об этом уже рассказывалось в предыдущем разделе, посвящённом команде <command>createdb</command>.</para>

   <para>В <command>psql</command> вы увидите следующее сообщение: <screen>
psql (&version;)
Type "help" for help.

mydb=&gt;
</screen> <indexterm><primary>суперпользователь</primary></indexterm> Последняя строка может выглядеть и так: <screen>
mydb=#
</screen> Что показывает, что вы являетесь суперпользователем, и так скорее всего будет, если вы устанавливали экземпляр <productname>&productname;</productname> сами. В этом случае на вас не будут распространяться никакие ограничения доступа, но для целей данного введения это не важно.</para>

   <para>Если вы столкнулись с проблемами при запуске <command>psql</command>, вернитесь к предыдущему разделу. Команды <command>createdb</command> и <command>psql</command> подключаются к серверу одинаково, так что если первая работает, должна работать и вторая.</para>

   <para>Последняя строка в выводе <command>psql</command> это приглашение, которое показывает, что <command>psql</command> ждёт ваших команд и вы можете вводить <acronym>SQL</acronym>-запросы в рабочей среде <command>psql</command>. Попробуйте эти команды: <indexterm><primary>версия</primary></indexterm> <screen>
<prompt>mydb=&gt;</prompt> <userinput>SELECT pgpro_version();</userinput>
                                         version
------------------------------------------------------------------------------------------
 &productname; &version; on x86_64-pc-linux-gnu, compiled by gcc (Debian 4.9.2-10) 4.9.2, 64-bit
(1 row)

<prompt>mydb=&gt;</prompt> <userinput>SELECT current_date;</userinput>
    date
------------
 2016-01-07
(1 row)

<prompt>mydb=&gt;</prompt> <userinput>SELECT 2 + 2;</userinput>
 ?column?
----------
        4
(1 row)
</screen></para>

   <para>В программе <command>psql</command> есть множество внутренних команд, которые не являются SQL-операторами. Они начинаются с обратной косой черты, <quote><literal>\</literal></quote>. Например, вы можете получить справку по различным <acronym>SQL</acronym>-командам <productname>&productname;</productname>, введя: <screen>
<prompt>mydb=&gt;</prompt> <userinput>\h</userinput>
</screen></para>

   <para>Чтобы выйти из <command>psql</command>, введите: <screen>
<prompt>mydb=&gt;</prompt> <userinput>\q</userinput>
</screen> и <command>psql</command> завершит свою работу, а вы вернётесь в командную оболочку операционной системы. (Чтобы узнать о внутренних командах, введите <literal>\?</literal> в приглашении командной строки <command>psql</command>.) Все возможности <command>psql</command> документированы в справке <xref remap="6" linkend="app-psql"/>. В этом руководстве мы не будем использовать эти возможности явно, но вы можете изучить их и применять при удобном случае.</para>

  </sect1>
 </chapter>
